<article class="task-item
	{{if this.hasTitle " has-title"}}
	{{if this.hasDueDate " has-due-date"}}
	{{if this.hasDescription " has-description"}}
	{{if this.isEditing " is-editing"}}">
	{{#if this.isEditing}}
		<form>
			<fieldset>
				<legend>Basic Information</legend>
				<label for="{{concat this.elementId "-title"}}">Title</label>
				<Input @type="text" @id={{concat this.elementId "-title"}} @value={{@task.title}} required={{true}} @autofocus={{true}} placeholder="TODO text here" @focus-out={{this.onSave}}/>
				<label for="{{concat this.elementId "-description"}}">Description</label>
				<Textarea @value={{@task.description}} @id={{concat this.elementId "-description"}} @rows={{10}} @focus-out={{this.onSave}}/>
			</fieldset>
			<fieldset>
				<legend>Due Date</legend>
				<label for="{{this.elementId}}-flexible-due-date">Flexible Due Date</label>
				<Input @type="checkbox" @name="due-date-type" id="{{this.elementId}}-flexible-due-date" @checked={{this.hasFlexibleDueDate}}/>

				{{#if this.hasFlexibleDueDate}}
					<label for="{{this.elementId}}-applicable-days">Applicable Days</label>
					<ol class="day-select">
						{{#each this.dueDateByDays as |day|}}
							<label for="{{this.elementId}}-{{day.day}}">{{day.day}}</label>
							<Input @type="checkbox" id="{{this.elementId}}-{{day.day}}" @checked={{day.selected}} {{on "change" (fn this.onToggleDay day.day)}}/>
							{{#if day.selected}}
								<label for="{{this.elementId}}-{{day.day}}-startTime">From</label>
								<Input @type="time" @value={{get (get this.args.task.dueDateByDays day.day) "startTime"}} id="{{this.elementId}}-{{day.day}}-startTime" required={{true}} @focus-out={{this.onSave}}/>
								<label for="{{this.elementId}}-{{day.day}}-endTime">To</label>
								<Input @type="time" @value={{get (get this.args.task.dueDateByDays day.day) "endTime"}} id="{{this.elementId}}-{{day.day}}-endTime" @focus-out={{this.onSave}}/>
							{{/if}}
						{{/each}}
					</ol>
				{{else}}
					<label for="{{this.elementId}}-due-date">Due Date</label>
					<Input @type="date" @value={{@task.dueDate}} id="{{this.elementId}}-due-date" min={{this.todayDate}} @focus-out={{this.onSave}}/>
				{{/if}}
			</fieldset>
			{{#if @tasks.length}}
				<fieldset>
					<legend>Related Task</legend>
					<p>If this task requires another task to be completed before it.</p>
					<label for="{{this.elementId}}-depends-on">Depends on</label>
					<select id="{{this.elementId}}-depends-on" {{on "change" fn (mut @task.relatedTask) this.relatedTask}}>
						{{#each @tasks as |task|}}
							<option value={{task.id}}>{{task.name}}</option>
						{{/each}}
					</select>
				</fieldset>
			{{/if}}
		</form>
	{{else}}
		{{#if this.hasTitle}}
			<h2 class="task-title">
				<label for="{{this.elementId}}-edit">
					{{#if @task.complete}}
						<del>{{@task.title}}</del>
					{{else}}
						{{@task.title}}
					{{/if}}
				</label>
			</h2>
		{{/if}}
		{{#if this.hasDueDate}}
			<dl class="task-meta">
				<dt>Due</dt>
				<dd><span class="task-due-date">{{moment-from-now @task.dueDate}}</span></dd>
			</dl>
		{{/if}}
		{{#if this.hasDescription}}
			<p class="task-description">{{@task.description}}</p>
		{{/if}}
	{{/if}}

	<ul class="task-actions" role="menubar">
		<li class="task-action">
			<label for="{{concat this.elementId "-complete"}}">{{svg-jar "checkmark"}}</label>
			<Input @type="checkbox" @id={{concat this.elementId "-complete"}} @checked={{@task.complete}}/>
		</li>
		<li class="task-action">
			<button>{{svg-jar "chat-bubble-dots"}}</button>
		</li>
		<li class="task-action">
			<label for="{{concat this.elementId "-edit"}}">{{svg-jar "edit-pencil"}}</label>
			<Input @type="checkbox" @id={{concat this.elementId "-edit"}} @checked={{this.isEditing}}/>
		</li>
		<li class="task-action">
			<button>{{svg-jar "edit-copy"}}</button>
		</li>
	</ul>

	{{#if @task.tasks.length}}
		<ol class="task-tasks">
			{{#each @task.tasks as |task|}}
				<li class="task-item-container">
					<TaskItem @task={{task}} @onSave={{@onSave}}/>
				</li>
			{{/each}}
		</ol>
	{{/if}}
	{{yield}}
</article>